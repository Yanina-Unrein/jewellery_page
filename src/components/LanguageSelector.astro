---
import { languages, defaultLang } from '../i18n/ui';
import { anchors } from '../i18n/anchors';

const { currentLang } = Astro.props;
const currentUrl = Astro.url;

function getLanguageUrl(targetLang: string) {
  const currentPath = currentUrl.pathname;
  const currentHash = currentUrl.hash;
  
  // Si hay un anchor en la URL actual
  if (currentHash) {
    const currentAnchor = currentHash.substring(1);
    
    // Buscamos el anchor equivalente en el idioma destino
    let targetAnchor = currentAnchor;
    
    // Primero buscamos en el idioma actual
    const currentLangAnchors = Object.entries(anchors[currentLang]);
    const foundAnchor = currentLangAnchors.find(([_, value]) => value === currentAnchor);
    
    // Si encontramos una correspondencia, usamos la clave para el idioma destino
    if (foundAnchor) {
      const [key] = foundAnchor;
      targetAnchor = anchors[targetLang][key] || currentAnchor;
    }
    
    // Construimos la URL
    if (targetLang === defaultLang) {
      return `/#${targetAnchor}`;
    } else {
      return `/${targetLang}/#${targetAnchor}`;
    }
  }

  // Para rutas sin anchor
  if (targetLang === defaultLang) {
    return currentPath.replace(/^\/[^/]+/, '') || '/';
  } else {
    const path = currentPath.replace(/^\/[^/]+/, '');
    return `/${targetLang}${path}`;
  }
}
---

<!-- Solo un enlace para cambiar de idioma -->
<div class="language-selector">
  <a 
    href={getLanguageUrl(currentLang === 'es' ? 'en' : 'es')} 
    class="lang-link"
  >
    <img class="language-icon" src="/icons/language.svg" alt="Language Icon" />
    {currentLang === 'es' ? 'ES' : 'EN'}  
  </a>
</div>

<style>
  .lang-link {
    display: flex;
    align-items: center;
    padding: 0.5rem 1rem;
    text-decoration: none;
    transition: all 0.3s ease;
    color: var(--coffee-brown);
    cursor: pointer;
  }

  .lang-link:hover{
    color: var(--walnut);
  }

  .language-icon {
    width: 40px;
    height: auto;
    margin-right: 0.5rem;
  }
</style>